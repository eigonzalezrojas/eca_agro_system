{% extends "base.html" %}

{% block title %}Inicio{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="mb-4">Métricas de cultivo</h1>
    
    <!-- Bloque estado general -->
    <div class="card bg-light shadow-sm mb-4" id="bloque-inicio">
        <div class="card-body">
            <h5 class="card-title text-center mb-4">Estado general</h5>
            <div class="row text-center justify-content-center">
                <!-- Bloque de temperatura -->
                <div class="col-md-2">
                    <div class="d-flex flex-column align-items-center">
                        <i class="bi bi-thermometer-half fa-3x text-secondary" style="font-size: 50px;"></i>
                        <p class="mt-2 mb-1">Temperatura</p>
                        <p id="temperatura" class="h4 fw-bold">--°C</p>
                    </div>
                </div>

                <!-- Bloque de humedad -->
                <div class="col-md-2">
                    <div class="d-flex flex-column align-items-center">
                        <i class="bi bi-water fa-3x text-secondary" style="font-size: 50px;"></i>
                        <p class="mt-2 mb-1">Humedad</p>
                        <p id="humedad" class="h4 fw-bold">--%</p>
                    </div>
                </div>

                <!-- Bloque de fecha y hora -->
                <div class="col-md-2">
                    <div class="d-flex flex-column align-items-center">
                        <i class="bi bi-clock fa-3x text-secondary" style="font-size: 50px;"></i>
                        <p class="mt-2 mb-1">Última actualización</p>
                        <p id="fecha-hora" class="h5 fw-bold">--/--/---- --:--:--</p>
                    </div>
                </div>

                <!-- Bloque de horas frío -->
                <div class="col-md-2">
                    <div class="d-flex flex-column align-items-center">
                        <i class="bi bi-snow fa-3x text-secondary" style="font-size: 50px;"></i>
                        <p class="mt-2 mb-1">Horas frío</p>
                        <div class="text-center">
                            <p id="horas-frio" class="h4 fw-bold mb-0" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Calculando...">--</p>
                            <small class="text-muted">últimas 24h</small>
                        </div>
                    </div>
                </div>

                <!-- Bloque de grados días -->
                <div class="col-md-2">
                    <div class="d-flex flex-column align-items-center">
                        <i class="bi bi-brightness-high fa-3x text-secondary" style="font-size: 50px;"></i>
                        <p class="mt-2 mb-1">Grados días acumulados</p>
                        <p id="gda" class="h4 fw-bold">--</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="row mb-4 align-items-end">
        <!-- Selector de dispositivo -->
        <div class="col-md-3 mb-3">
            <label for="chipidSelect" class="form-label">Dispositivo</label>
            <select id="chipidSelect" class="form-select">
                <option value="">Todos los dispositivos</option>
                {% for chipid in chipids %}
                <option value="{{ chipid }}">Dispositivo {{ chipid }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Selector de período -->
        <div class="col-md-3 mb-3">
            <label for="periodSelect" class="form-label">Período</label>
            <select id="periodSelect" class="form-select">
                <option value="day">Último día</option>
                <option value="week">Última semana</option>
                <option value="month">Por mes</option>
                <option value="custom">Por fecha</option>
            </select>
        </div>

        <!-- Contenedor para selección por mes (año y mes) -->
        <div class="col-md-6 mb-3" id="monthYearContainer" style="display: none;">
            <div class="row">
                <!-- Selector de año -->
                <div class="col-md-6">
                    <label for="yearSelect" class="form-label">Año</label>
                    <select id="yearSelect" class="form-select"></select>
                </div>
                <!-- Selector de mes -->
                <div class="col-md-6">
                    <label for="monthSelect" class="form-label">Mes</label>
                    <select id="monthSelect" class="form-select">
                        <option value="01">Enero</option>
                        <option value="02">Febrero</option>
                        <option value="03">Marzo</option>
                        <option value="04">Abril</option>
                        <option value="05">Mayo</option>
                        <option value="06">Junio</option>
                        <option value="07">Julio</option>
                        <option value="08">Agosto</option>
                        <option value="09">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Contenedor para fecha específica -->
        <div class="col-md-3 mb-3" id="customDateContainer" style="display: none;">
            <label for="customDate" class="form-label">Fecha específica</label>
            <input type="date" id="customDate" class="form-control">
        </div>
    </div>
    
    <!-- Gráficos -->
    <div id="chartContainer">
        <div class="row">
            <div class="col-md-6 mb-4">
                <canvas id="tempChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="humChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Tabla de Temperatura -->
    <div id="temperatureTableContainer" class="table-container">
        <table id="temperatureTable" class="table table-striped">
            <thead>
                <tr>
                    <th>Dispositivo</th>
                    <th>Temperatura Máxima (°C)</th>
                    <th>Temperatura Mínima (°C)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se generarán dinámicamente -->
            </tbody>
        </table>
    </div>

    <!-- Tabla de Humedad -->
    <div id="humidityTableContainer" class="table-container">
        <table id="humidityTable" class="table table-striped">
            <thead>
                <tr>
                    <th>Dispositivo</th>
                    <th>Humedad Máxima (%)</th>
                    <th>Humedad Mínima (%)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se generarán dinámicamente -->
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js', v='1.0') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js', v='1.0') }}"></script>
{% endblock %}